@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix sosa: <http://www.w3.org/ns/sosa/> .
@prefix : <http://www.semanticweb.org/matheusdbampi/ontologies/2023/6/aal-ontology-lite/> .

# ---------------------------------------------
#               General Rules
# ---------------------------------------------

# if an observation is made by a sensor that observes a property, then the observation also observes the same property
[observesInference: 
    (?o rdf:type sosa:Observation) 
    (?o sosa:madeBySensor ?s) 
    (?s sosa:observes ?op) 
    -> 
    (?o sosa:observes ?op)
]

# if an observation is made by a sensor that has a feature of interest, then the observation also has the same feature of interest
[featureOfInterestInference: 
    (?o rdf:type sosa:Observation) 
    (?o sosa:madeBySensor ?s)
    (?s sosa:hasFeatureOfInterest ?foi) 
    -> 
    (?o sosa:hasFeatureOfInterest ?foi)
]

# if an observation inferred a finding, then the finding was inferred by the observation
[inferenceInference: 
    (?o rdf:type sosa:Observation) 
    (?o :inferred ?f) 
    -> 
    (?f :inferredBy ?o)
]


# ---------------------------------------------
#               Medical Rules
# ---------------------------------------------

# if the heart rate is above 80 trigger a heartrate event
# associate the event with the observation that triggered it
[TachycardiaRule:
    (?o rdf:type sosa:Observation) 
    (?o sosa:observes :HeartRate) 
    (?o sosa:hasSimpleResult ?r) 
    greaterThan(?r, 80)
    (?patient rdf:type :Patient)
    -> 
    (?patient :hasFinding :Tachycardia)
    (?o :inferred :Tachycardia)
]

# if the heart rate is below 75 trigger a heartrate event
# associate the event with the observation that triggered it
[BradycardiaRule:
    (?o rdf:type sosa:Observation) 
    (?o sosa:observes :HeartRate) 
    (?o sosa:hasSimpleResult ?r) 
    lessThan(?r, 75)
    (?patient rdf:type :Patient)
    -> 
    (?patient :hasFinding :Bradycardia)
    (?o :inferred :Bradycardia)
]

# if the patient has diabetes and the blood glucose is above 200 trigger a hyperglycemia finding
# associate the finding with the observation that triggered it
[HyperglycemiaRule:
    (?patient rdf:type :Patient)
    (?patient :hasMedicalCondition :Diabetes)
    (?patient :wears ?s)
    (?o rdf:type sosa:Observation)
    (?o sosa:madeBySensor ?s)
    (?o sosa:observes :BloodGlucose)
    (?o sosa:hasSimpleResult ?r)
    greaterThan(?r, 200)
    -> 
    (?patient :hasFinding :Hyperglycemia)
    (?o :inferred :Hyperglycemia)
]

# if the patient has diabetes and the blood glucose is below 70 trigger a hypoglycemia finding
# associate the finding with the observation that triggered it
[HypoglycemiaRule:
    (?patient rdf:type :Patient)
    (?patient :hasMedicalCondition :Diabetes)
    (?patient :wears ?s)
    (?o rdf:type sosa:Observation)
    (?o sosa:madeBySensor ?s)
    (?o sosa:observes :BloodGlucose)
    (?o sosa:hasSimpleResult ?r)
    lessThan(?r, 70)
    -> 
    (?patient :hasFinding :Hypoglycemia)
    (?o :inferred :Hypoglycemia)
]