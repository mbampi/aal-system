@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix sosa: <http://www.w3.org/ns/sosa/> .
@prefix sct: <http://snomed.info/id/> .
@prefix : <http://www.semanticweb.org/matheusdbampi/ontologies/2023/7/aal-ontology#> .

# ---------------------------------------------
#               General Rules
# ---------------------------------------------

# if an observation is made by a sensor that observes a property, then the observation also observes the same property
[observesInference: 
    (?o rdf:type sosa:Observation) 
    (?o sosa:madeBySensor ?s) 
    (?s sosa:observes ?op) 
    -> 
    (?o sosa:observes ?op)
]

# if an observation is made by a sensor that has a feature of interest, then the observation also has the same feature of interest
[featureOfInterestInference: 
    (?o rdf:type sosa:Observation) 
    (?o sosa:madeBySensor ?s)
    (?s sosa:hasFeatureOfInterest ?foi) 
    -> 
    (?o sosa:hasFeatureOfInterest ?foi)
]

# if an observation inferred a finding, then the finding was inferred by the observation
[inferenceInference: 
    (?o rdf:type sosa:Observation) 
    (?o :inferred ?f) 
    -> 
    (?f :inferredBy ?o)
]


# ---------------------------------------------
#               Medical Rules
# ---------------------------------------------

# if the heart rate is above 75 trigger a heartrate event
# associate the event with the observation that triggered it
# HeartRate = 364075005
# Tachycardia = 3424008
# Patient = 116154003
[TachycardiaRule:
    (?o rdf:type sosa:Observation) 
    (?o sosa:observes sct:364075005)  
    (?o sosa:hasSimpleResult ?r) 
    greaterThan(?r, 80)
    (?patient rdf:type sct:116154003)
    -> 
    (?patient :hasFinding sct:3424008)
    (?o :inferred sct:3424008)
]

# if the heart rate is below 75 trigger a heartrate event
# associate the event with the observation that triggered it
# HeartRate = 364075005
# Bradycardia = 48867003
[BradycardiaRule:
    (?o rdf:type sosa:Observation) 
    (?o sosa:observes sct:364075005)
    (?o sosa:hasSimpleResult ?r) 
    lessThan(?r, 75)
    (?patient rdf:type sct:116154003)
    -> 
    (?patient :hasFinding sct:48867003) 
    (?o :inferred sct:48867003)
]

# if the patient has diabetes and the blood glucose is above 200 trigger a hyperglycemia finding
# associate the finding with the observation that triggered it
# Diabetes = 73211009
# Blood Glucose Level = 365812005
# Hyperglycemia = 80394007
[HyperglycemiaRule:
    (?patient rdf:type sct:116154003)
    (?patient :hasMedicalCondition sct:73211009) 
    (?patient :wears ?s)
    (?o rdf:type sosa:Observation)
    (?o sosa:madeBySensor ?s)
    (?o sosa:observes :365812005) 
    (?o sosa:hasSimpleResult ?r)
    greaterThan(?r, 200)
    -> 
    (?patient :hasFinding sct:80394007) 
    (?o :inferred sct:80394007)
]

# if the patient has diabetes and the blood glucose is below 70 trigger a hypoglycemia finding
# associate the finding with the observation that triggered it
# Diabetes = 73211009
# Blood Glucose Level = 365812005
# Hypoglycemia = 302866003
[HypoglycemiaRule:
    (?patient rdf:type sct:116154003)
    (?patient :hasMedicalCondition sct:73211009) 
    (?patient :wears ?s)
    (?o rdf:type sosa:Observation)
    (?o sosa:madeBySensor ?s)
    (?o sosa:observes sct:365812005) 
    (?o sosa:hasSimpleResult ?r)
    lessThan(?r, 70)
    -> 
    (?patient :hasFinding sct:302866003) 
    (?o :inferred sct:302866003)
]